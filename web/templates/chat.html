{{define "styles"}}
    {{/* --- Tailwind CSS, Google Fonts & Icons --- */}}
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <style type="text/tailwindcss">
        :root {
            --primary-color: #13a4ec;
            --background-color: #f8fafc;
            --text-primary: #1e2b3b;
            --text-secondary: #64748b;
            --container-bg: #ffffff;
            --input-bg: #f1f5f9;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        textarea {
            resize: none;
        }

        /* --- Blinking Cursor for Streaming --- */
        .streaming-text-fragment::after {
            content: 'â–‹';
            animation: blink 1s step-end infinite;
            margin-left: 2px;
            color: var(--primary-color);
        }
        @keyframes blink {
            50% { opacity: 0; }
        }

        /* === THIS IS THE COMPLETE, FINAL STYLING FIX === */
        /* --- Comprehensive Markdown Styles --- */
        .message-bubble h1, .message-bubble h2, .message-bubble h3, .message-bubble h4 {
            @apply font-bold text-gray-800;
        }
        .message-bubble h1 { @apply text-2xl mb-4 mt-5 border-b pb-2; }
        .message-bubble h2 { @apply text-xl mb-3 mt-4 border-b pb-2; }
        .message-bubble h3 { @apply text-lg mb-2 mt-3; }
        .message-bubble h4 { @apply text-base mb-2 mt-2; }
        
        .message-bubble p { @apply mb-4 leading-relaxed; }
        
        .message-bubble ul, .message-bubble ol { @apply list-inside pl-5 mb-4 space-y-2; }
        .message-bubble ul { @apply list-disc; }
        .message-bubble ol { @apply list-decimal; }
        .message-bubble li::marker { @apply text-gray-500; }

        .message-bubble blockquote { @apply border-l-4 border-gray-300 pl-4 py-2 my-4 bg-gray-50 text-gray-600 italic; }
        
        .message-bubble code { @apply bg-gray-200 text-gray-800 rounded px-1.5 py-1 text-sm font-mono; }
        .message-bubble pre { @apply bg-gray-800 text-white rounded-lg p-4 my-4 overflow-x-auto; }
        .message-bubble pre code { @apply bg-transparent text-white p-0; }

        .message-bubble a { @apply text-blue-600 underline hover:text-blue-800; }
        
        .message-bubble hr { @apply my-6 border-gray-200; }

        .message-bubble table { @apply w-full border-collapse text-sm my-4; }
        .message-bubble th, .message-bubble td { @apply border border-gray-300 p-2 text-left align-top; }
        .message-bubble th { @apply bg-gray-100 font-semibold text-gray-700; }
        .message-bubble tr:nth-child(even) { @apply bg-gray-50/50; }

        /* --- Footnote Styles --- */
        .footnotes { @apply mt-6 border-t border-gray-200 pt-4; }
        .footnotes ol { @apply pl-5 space-y-2; }
        .footnotes li { @apply text-sm text-gray-600; }
        .footnote-ref, .footnote-backref { @apply text-[var(--primary-color)] no-underline hover:underline; }
    </style>
{{end}}

{{define "scripts"}}
    <script type="module" src="/static/js/chat/chat.js"></script>
    <script src="/static/js/credit-manager.js"></script>
{{end}}

{{define "content"}}
    {{/* The rest of your HTML content remains exactly the same. */}}
    <div class="flex h-screen w-full bg-[var(--background-color)] text-[var(--text-primary)]">
        <aside class="flex w-64 shrink-0 flex-col border-r border-gray-200 bg-[var(--container-bg)]">
            <div class="flex h-16 shrink-0 items-center justify-between border-b border-gray-200 px-4">
                <a href="/chat" class="flex items-center gap-3">
                    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-[var(--primary-color)] text-white">
                        <span class="material-symbols-outlined text-xl">health_and_safety</span>
                    </div>
                    <h1 class="text-xl font-bold">Internist AI</h1>
                </a>
            </div>
            <div class="flex flex-col gap-4 p-4">
                <a href="/chat" id="newChatBtn" class="flex w-full items-center justify-center gap-2 rounded-md bg-[var(--primary-color)] px-3 py-2 text-sm font-medium text-white hover:bg-opacity-90">
                    <span class="material-symbols-outlined text-lg">add</span>
                    New Chat
                </a>
            </div>
            <div class="flex-1 overflow-y-auto">
                <nav class="flex flex-col px-4">
                    <h2 class="mb-2 text-xs font-semibold uppercase text-[var(--text-secondary)]">Previous Chats</h2>
                    <div id="historyList" class="flex flex-col space-y-1"></div>
                </nav>
            </div>
            <div class="border-t border-gray-200 p-4">
                 <a href="/logout" class="flex w-full items-center gap-3 rounded-md px-3 py-2 text-sm font-medium text-[var(--text-secondary)] hover:bg-gray-100">
                    <span class="material-symbols-outlined text-lg">logout</span>
                    <span>Logout</span>
                </a>
            </div>
        </aside>
        <div class="flex h-screen w-full flex-col">
            <header class="flex h-16 shrink-0 items-center justify-between border-b border-gray-200 bg-[var(--container-bg)] px-6">
                <div></div>
                <div class="flex items-center gap-4">
                    <div class="text-sm text-[var(--text-secondary)]">
                        <span id="current-balance">--</span> Credits
                    </div>
                    <div class="h-10 w-10 rounded-full bg-cover bg-center" style='background-image: url("/static/img/user-avatar.png");'></div>
                </div>
            </header>
            <main class="flex flex-1 flex-col overflow-y-auto">
                <div id="chatMessages" class="mx-auto w-full max-w-4xl flex-1 space-y-8 px-4 py-8 sm:px-6 lg:px-8"></div>
                <div class="sticky bottom-0 bg-[var(--background-color)]/80 backdrop-blur-sm">
                    <div class="mx-auto w-full max-w-4xl px-4 py-4 sm:px-6 lg:px-8">
                        <form id="chatForm" class="relative">
                            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                            <textarea id="chatInput" class="w-full rounded-full border-gray-300 bg-[var(--input-bg)] py-3 pl-5 pr-28 text-base text-[var(--text-primary)] placeholder:text-[var(--text-secondary)] focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Ask me anything..." rows="1"></textarea>
                            <div class="absolute inset-y-0 right-3 flex items-center gap-2">
                                <button type="submit" class="flex h-8 w-8 items-center justify-center rounded-full bg-[var(--primary-color)] text-white hover:bg-opacity-90 disabled:bg-gray-400" aria-label="Send message">
                                    <span class="material-symbols-outlined text-xl">send</span>
                                </button>
                            </div>
                        </form>
                         <small class="mt-2 block text-center text-xs text-gray-500">
                            Internist may display inaccurate info; double-check its responses.
                        </small>
                    </div>
                </div>
            </main>
        </div>
    </div>
{{end}}
