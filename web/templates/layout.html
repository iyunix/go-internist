<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .Title}}{{.Title}}{{else}}Internist{{end}}</title>

    <!-- =========================
         Fonts (Load First)
    ========================== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link 
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" 
        rel="stylesheet"
    >

    <!-- =========================
         Base Styles (Load Second)
    ========================== -->
    <link rel="stylesheet" href="/static/css/main.css">
    
    <!-- =========================
         Page-specific Styles (Load Third)
    ========================== -->
    {{block "styles" .}}{{end}}

    <!-- =========================
         Emergency CSS Fix (Load LAST - Highest Priority)
    ========================== -->
    <style>
    /* Force light theme - loads after all external CSS */
    html, body {
        background-color: white !important;
        color: #333 !important;
        margin: 0;
        padding: 0;
    }
    
    main, .chat-layout, .content {
        background-color: white !important;
        color: #333 !important;
    }
    
    .sidebar {
        background-color: #f8f9fa !important;
        color: #333 !important;
        border-right: 1px solid #e9ecef !important;
    }
    
    .chat-main {
        background-color: white !important;
        color: #333 !important;
    }
    
    .message-item {
        color: #333 !important;
    }
    
    .message-bubble {
        background-color: #f1f3f4 !important;
        color: #333 !important;
        border: 1px solid #e9ecef !important;
    }
    
    input, textarea, button {
        background-color: white !important;
        color: #333 !important;
        border: 1px solid #ccc !important;
    }
    
    a, .btn, .new-chat-btn, .logout-btn {
        color: #007bff !important;
        background-color: transparent !important;
    }
    
    a:hover, .btn:hover {
        color: #0056b3 !important;
    }
    
    .history-item {
        color: #333 !important;
        background-color: transparent !important;
    }
    
    .history-item.active {
        background-color: #e7f3ff !important;
    }
    </style>

    <!-- =========================
         Theme Handling (Simplified)
    ========================== -->
    <script>
    (function() {
        // Force light theme immediately
        document.documentElement.setAttribute("data-theme", "light");
        document.documentElement.style.colorScheme = "light";
    })();
    </script>

    <!-- =========================
         Alpine.js
    ========================== -->
    <script 
        defer 
        src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js">
    </script>
</head>
<body>
    <!-- =========================
         Page Content
    ========================== -->
    <main>
        {{block "content" .}}{{end}}
    </main>

    <!-- =========================
         Vendor Scripts
    ========================== -->
    <script src="/static/js/logger.js"></script>
    <script src="/static/js/vendor/marked.umd.js"></script>
    <script src="/static/js/vendor/purify.min.js"></script>
    <script src="/static/js/markdown_renderer.js"></script>

    <!-- =========================
         Page-specific Scripts
    ========================== -->
    {{block "scripts" .}}{{end}}

    <!-- =========================
         Final Style Enforcement
    ========================== -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Final enforcement of white background
        document.body.style.backgroundColor = "white";
        document.body.style.color = "#333";
        console.log('Layout loaded - background enforced');
    });
    </script>
</body>
</html>
